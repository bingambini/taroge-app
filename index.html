<style>
    /* ... (წინა სტილები უცვლელად რჩება) ... */
    
    /* ვამატებთ მხოლოდ დეტალების ფანჯრის სტილს */
    #details-overlay { 
        position: fixed; inset: 0; background: var(--white); z-index: 2000; 
        display: none; flex-direction: column; animation: slideUp 0.3s ease-out;
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    
    .chip-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    .chip { padding: 10px 15px; border-radius: 12px; background: #f2f2f7; font-weight: 700; cursor: pointer; font-size: 14px; }
    .chip.selected { background: var(--black); color: white; }
    .close-det { position: absolute; top: 20px; left: 20px; z-index: 10; font-size: 24px; }
</style>

<div id="details-overlay">
    <i class="fa-solid fa-xmark close-det" onclick="closeDetails()"></i>
    <div style="padding:40px 20px; text-align:center;">
        <img id="det-img" style="width:100%; max-height:250px; object-fit:contain;">
    </div>
    <div style="padding:25px; flex:1; overflow-y:auto;">
        <h1 id="det-name" style="margin:0; font-size:24px; font-weight:900;"></h1>
        <div id="det-price" style="color:var(--black); font-size:22px; font-weight:900; margin-top:5px;"></div>
        <p id="det-desc" style="color:var(--gray); font-size:14px; margin:15px 0;"></p>
        
        <div style="font-weight:800; margin-top:10px;">ზომა</div>
        <div id="size-chips" class="chip-container"></div>
        
        <div style="font-weight:800; margin-top:10px;">ფერი</div>
        <div id="color-chips" class="chip-container"></div>
    </div>
    <div style="padding:20px; padding-bottom:40px;">
        <button class="btn-main" onclick="confirmAddToCart()">კალათაში დამატება</button>
    </div>
</div>

<script>
    /* ... (ყველა წინა ცვლადი და init ფუნქცია უცვლელია) ... */
    let currentP = null, selSize = '', selColor = '';

    // პროდუქტების რენდერინგისას ვაბრუნებთ onclick-ს დეტალებისთვის
    function renderProducts(list) {
        const grid = document.getElementById('products-grid');
        grid.innerHTML = '';
        list.forEach(p => {
            if(!p.name) return;
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<img src="${p.img}"><h3>${p.name}</h3><b>${p.price}₾</b>`;
            // ახლა დაჭერისას იხსნება დეტალები და არა პირდაპირ კალათა
            card.onclick = () => openDetails(p); 
            grid.appendChild(card);
        });
        // ბანერზეც იგივე ლოგიკა
        const top = list.find(p => p.status?.toLowerCase().includes('top'));
        if(top) {
            const hb = document.getElementById('hero-banner');
            hb.style.display = 'block';
            document.getElementById('h-img').src = top.img;
            document.getElementById('h-price').innerText = top.price + '₾';
            hb.onclick = () => openDetails(top);
        }
    }

    function openDetails(p) {
        currentP = p; selSize = ''; selColor = '';
        document.getElementById('det-name').innerText = p.name;
        document.getElementById('det-price').innerText = p.price + '₾';
        document.getElementById('det-desc').innerText = p.desc || '';
        document.getElementById('det-img').src = p.img;
        
        // ჩიპების შექმნა ზომებისთვის და ფერებისთვის (მონაცემები Sheets-დანაა)
        renderChips('size-chips', p.sizes, 'size');
        renderChips('color-chips', p.colors, 'color');
        
        document.getElementById('details-overlay').style.display = 'flex';
    }

    function renderChips(id, vals, type) {
        const container = document.getElementById(id); container.innerHTML = '';
        if(!vals || vals.length === 0 || vals[0] === "") {
            container.innerHTML = '<span style="color:var(--gray)">არ არის მითითებული</span>';
            return;
        }
        vals.forEach(v => {
            const val = v.trim();
            const ch = document.createElement('div'); ch.className = 'chip'; ch.innerText = val;
            ch.onclick = () => {
                container.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                ch.classList.add('selected');
                if(type === 'size') selSize = val; else selColor = val;
            };
            container.appendChild(ch);
        });
    }

    function confirmAddToCart() {
        if(currentP.sizes?.[0] !== "" && !selSize) return tg.showAlert("გთხოვთ აირჩიოთ ზომა");
        if(currentP.colors?.[0] !== "" && !selColor) return tg.showAlert("გთხოვთ აირჩიოთ ფერი");
        
        cart.push({ ...currentP, selectedSize: selSize, selectedColor: selColor });
        updateCart();
        closeDetails();
        tg.HapticFeedback.notificationOccurred('success');
    }

    function closeDetails() { document.getElementById('details-overlay').style.display = 'none'; }
    
    // ... (updateCart და სხვა ფუნქციები რჩება უცვლელი) ...
</script>
