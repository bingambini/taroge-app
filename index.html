<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; background: #f2f2f7; margin: 0; padding: 0; }
        .header { background: white; padding: 20px; display: flex; align-items: center; border-bottom: 1px solid #ddd; }
        .shop-logo { height: 50px; border-radius: 8px; margin-right: 15px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 15px; padding: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card img { width: 100%; border-radius: 10px; }
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: #1c1c1e; display: flex; justify-content: space-around; padding: 15px 0; color: white; }
        .view { display: none; padding-bottom: 80px; }
        .view.active { display: block; }
        .overlay { position: fixed; inset: 0; background: white; z-index: 100; display: none; flex-direction: column; padding: 20px; }
    </style>
</head>
<body>

    <div id="main-view" class="view active">
        <div class="header">
            <img id="logo" class="shop-logo" src="" style="display:none;">
            <h1 id="shop-name" style="margin:0; font-size:18px;">Svaqi Store</h1>
        </div>
        <div id="products" class="grid"></div>
    </div>

    <div id="cart-view" class="view">
        <h2 style="text-align:center;">კალათა</h2>
        <div id="cart-items"></div>
        <button onclick="document.getElementById('checkout').style.display='flex'" style="width:90%; margin:20px 5%; padding:15px; background:black; color:white; border-radius:10px; border:none;">შეკვეთა</button>
    </div>

    <div id="checkout" class="overlay">
        <h2>მონაცემები</h2>
        <input type="text" id="name" placeholder="სახელი" style="width:100%; padding:10px; margin-bottom:10px;">
        <input type="text" id="addr" placeholder="მისამართი" style="width:100%; padding:10px; margin-bottom:10px;">
        <button onclick="sendOrder()" style="width:100%; padding:15px; background:green; color:white; border:none; border-radius:10px;">გაგზავნა</button>
        <button onclick="this.parentElement.style.display='none'" style="margin-top:10px; border:none; background:none; color:red;">გაუქმება</button>
    </div>

    <div class="tab-bar">
        <div onclick="show('main')"><i class="fa-solid fa-house"></i></div>
        <div onclick="show('cart')"><i class="fa-solid fa-cart-shopping"></i></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        let products = [], cart = [];
        const SHEET_ID = '1vQH2mZB4PnZn6hJJRPgC_Ry0HTt7BvKiNmcNGyx7PVOMHY0rNFqhM4MneVoRI3kT00y6vxMMOoHbipA';

        async function load() {
            try {
                const res = await fetch(`https://docs.google.com/spreadsheets/d/e/2PACX-${SHEET_ID}/pub?gid=0&output=csv&t=${Date.now()}`);
                const data = await res.text();
                products = data.split('\n').slice(1).map(row => {
                    const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return { name: c[0].replace(/"/g,''), price: c[1], img: c[2].replace(/"/g,'').split(',')[0] };
                });
                const grid = document.getElementById('products');
                products.forEach(p => {
                    grid.innerHTML += `<div class="card" onclick="addToCart('${p.name}', ${p.price})"><img src="${p.img}"><h3>${p.name}</h3><b>${p.price}₾</b></div>`;
                });
            } catch(e) { alert("შეცდომა მონაცემების წამოღებისას"); }
        }

        function addToCart(n, p) {
            cart.push({name: n, price: p});
            tg.showAlert(n + " დაემატა კალათაში!");
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            container.innerHTML = '';
            cart.forEach(i => { container.innerHTML += `<p style="padding:10px; border-bottom:1px solid #ddd;">${i.name} - ${i.price}₾</p>`; });
        }

        function show(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id + '-view').classList.add('active');
        }

        function sendOrder() {
            tg.showAlert("შეკვეთა მიღებულია! (დემო)");
            cart = []; renderCart();
            document.getElementById('checkout').style.display = 'none';
            show('main');
        }

        load();
    </script>
</body>
</html>
